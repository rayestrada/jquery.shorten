!function(e){e.fn.shorten=function(s){"use strict";var t={showChars:100,minHideChars:10,ellipsesText:"...",moreText:"more",lessText:"less",onLess:function(){},onMore:function(){},errMsg:null,force:!1};return s&&e.extend(t,s),e(this).data("jquery.shorten")&&!t.force?!1:(e(this).data("jquery.shorten",!0),e(document).off("click",".morelink"),e(document).on({click:function(){var s=e(this);return s.hasClass("less")?(s.removeClass("less"),s.html(t.moreText),s.parent().prev().prev().show(),s.parent().prev().hide(0,function(){t.onLess()})):(s.addClass("less"),s.html(t.lessText),s.parent().prev().prev().hide(),s.parent().prev().show(0,function(){t.onMore()})),!1}},".morelink"),this.each(function(){var s=e(this),n=s.html().trim(),r=n.length,o=n.substr(t.showChars,r-t.showChars).indexOf(" "),l=t.showChars+o;if(r>l+t.minHideChars){var a=n.substr(0,l);if(a.indexOf("<")>=0){for(var i=!1,h="",c=0,f=[],u=null,d=0,m=0;l>=m;d++){if("<"!=n[d]||i||(i=!0,u=n.substring(d+1,n.indexOf(">",d)),"/"==u[0]?u!="/"+f[0]?t.errMsg="ERROR en HTML: the top of the stack should be the tag that closes":f.shift():"br"!=u.toLowerCase()&&f.unshift(u)),i&&">"==n[d]&&(i=!1),i)h+=n.charAt(d),console.log("intag "+h);else if(l>=c)h+=n.charAt(d),console.log("outtag "+h),c++;else if(f.length>0){for(j=0;j<f.length;j++)h+="</"+f[j]+">";break}m++}a=e("<div/>").html(h+'<span class="ellip">'+t.ellipsesText+"</span>").html()}else a+=t.ellipsesText;var p='<div class="shortcontent">'+a+'</div><div class="allcontent">'+n+'</div><span><a href="javascript://nop/" class="morelink">'+t.moreText+"</a></span>";s.html(p),s.find(".allcontent").hide(),e(".shortcontent > *:last",s).css("margin-bottom",0)}}))}}(jQuery);